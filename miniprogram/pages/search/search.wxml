<!--search.wxml-->
<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content">
      <view class="navbar-left">
        <view class="back-btn" bind:tap="onBack">
          <text class="back-icon">â€¹</text>
        </view>
      </view>
    </view>
    
    <!-- æœç´¢æ¡†å®¹å™¨ - ä¸é¦–é¡µä¿æŒä¸€è‡´çš„ä½ç½® -->
    <view class="search-wrapper">
      <view class="search-navbar-content">
        <view class="search-container">
          <view class="search-box">
            <text class="search-icon">ğŸ”</text>
            <input 
              class="search-input" 
              placeholder="æœç´¢å¿ƒä»ªçš„é—²ç½®å®è´"
              value="{{searchKeyword}}"
              bindinput="onSearchInput"
              bindconfirm="onSearch"
              focus="{{inputFocused}}"
              bindfocus="onInputFocus"
              bindblur="onInputBlur"
            />
            <view 
              wx:if="{{searchKeyword}}" 
              class="search-clear"
              bind:tap="clearSearch"
            >
              <text class="clear-icon">Ã—</text>
            </view>
          </view>
        </view>
        <view class="navbar-right">
          <text class="search-btn" bind:tap="onSearch">æœç´¢</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒº -->
  <scroll-view class="main-content" scroll-y enhanced show-scrollbar="{{false}}">
    <!-- æœç´¢çŠ¶æ€ï¼šåˆå§‹çŠ¶æ€ -->
    <view wx:if="{{searchStatus === 'idle'}}" class="search-initial">
      <!-- æœç´¢å†å² -->
      <view wx:if="{{searchHistory.length > 0}}" class="section">
        <view class="section-header">
          <text class="section-title">æœç´¢å†å²</text>
          <text class="section-link" bind:tap="clearHistory">æ¸…ç©º</text>
        </view>
        <view class="history-tags">
          <view 
            class="history-tag" 
            wx:for="{{searchHistory}}" 
            wx:key="*this"
            bind:tap="onHistoryTap"
            data-keyword="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- çƒ­é—¨æœç´¢ -->
      <view class="section">
        <view class="section-header">
          <text class="section-title">çƒ­é—¨æœç´¢</text>
        </view>
        <view class="hot-tags">
          <view 
            class="hot-tag" 
            wx:for="{{hotSearches}}" 
            wx:key="*this"
            bind:tap="onHotTap"
            data-keyword="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢çŠ¶æ€ï¼šæœç´¢ä¸­ -->
    <view wx:if="{{searchStatus === 'searching'}}" class="search-loading">
      <t-loading theme="circular" size="40rpx" text="æœç´¢ä¸­..." />
    </view>

    <!-- æœç´¢çŠ¶æ€ï¼šæ— ç»“æœ -->
    <view wx:if="{{searchStatus === 'empty'}}" class="search-empty">
      <view class="empty-icon">
        <t-icon name="search" size="64rpx" color="#94a3b8" />
      </view>
      <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³ç‰©å“</text>
      <text class="empty-desc">è¯•è¯•å…¶ä»–å…³é”®è¯æˆ–æµè§ˆçƒ­é—¨æ¨è</text>
    </view>

    <!-- æœç´¢çŠ¶æ€ï¼šé”™è¯¯ -->
    <view wx:if="{{searchStatus === 'error'}}" class="search-error">
      <view class="error-icon">
        <t-icon name="close-circle" size="64rpx" color="#f56565" />
      </view>
      <text class="error-text">æœç´¢å¤±è´¥</text>
      <text class="error-desc">{{errorMessage}}</text>
      <t-button theme="primary" size="small" bind:tap="onRetry">é‡è¯•</t-button>
    </view>

    <!-- æœç´¢çŠ¶æ€ï¼šæœ‰ç»“æœ -->
    <view wx:if="{{searchStatus === 'success'}}" class="search-results">
      <view class="results-header">
        <text class="results-count">æ‰¾åˆ° {{searchResults.length}} ä¸ªç‰©å“</text>
        <view class="sort-options">
          <text class="sort-label">æ’åºï¼š</text>
          <view class="sort-tags">
            <view 
              class="sort-tag {{sortType === 'time' ? 'active' : ''}}"
              bind:tap="onSortChange"
              data-type="time"
            >
              æœ€æ–°
            </view>
            <view 
              class="sort-tag {{sortType === 'price' ? 'active' : ''}}"
              bind:tap="onSortChange"
              data-type="price"
            >
              ä»·æ ¼
            </view>
          </view>
        </view>
      </view>

      <view class="item-list">
        <view 
          class="item-card" 
          wx:for="{{searchResults}}" 
          wx:key="id"
          bind:tap="onItemTap"
          data-id="{{item._id || item.id}}"
        >
          <view class="item-image {{item.status === 'sold' ? 'item-image-sold' : ''}}">
            <image 
              wx:if="{{item.images && item.images.length > 0}}"
              src="{{item.images[0]}}"
              mode="aspectFill"
              class="item-image-img"
              lazy-load
            />
            <text wx:else class="item-image-text">{{item.imageText || 'æš‚æ— å›¾ç‰‡'}}</text>
          </view>
          <view class="item-info">
            <view class="item-header">
              <text class="item-title">{{item.title}}</text>
              <t-tag 
                theme="{{item.statusTheme}}" 
                variant="light" 
                size="small"
              >
                {{item.statusText}}
              </t-tag>
            </view>
            <text class="item-desc">{{item.description}}</text>
            
            <view class="item-price-row">
              <text class="item-price {{item.status === 'sold' ? 'item-price-sold' : ''}}">Â¥{{item.price}}</text>
              <view class="item-stats">
                <t-icon name="browse" size="14px" color="#94a3b8" />
                <text class="item-stats-text">{{item.views}} äººå…³æ³¨</text>
              </view>
            </view>

            <view class="item-footer">
              <view class="item-footer-left">
                <t-icon 
                  name="{{item.footerIcon}}" 
                  size="14px" 
                  color="{{item.footerColor}}" 
                />
                <text class="item-footer-text" style="color: {{item.footerColor}}">
                  {{item.footerText}}
                </text>
              </view>
              <t-button 
                wx:if="{{item.status === 'available'}}"
                theme="primary" 
                size="small"
                variant="outline"
                bind:tap="onLockItem"
                data-id="{{item.id}}"
              >
                å»é”å®š
              </t-button>
              <t-button 
                wx:elif="{{item.status === 'locked'}}"
                theme="default" 
                size="small"
                bind:tap="onFollowItem"
                data-id="{{item.id}}"
              >
                å…³æ³¨
              </t-button>
              <text 
                wx:else
                class="item-link"
                catch:tap="onViewDetail"
                data-id="{{item.id}}"
              >
                æŸ¥çœ‹è¯¦æƒ…
              </text>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{hasMore}}" class="load-more">
        <t-loading theme="circular" size="32rpx" text="åŠ è½½æ›´å¤š..." />
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-spacer"></view>
  </scroll-view>
</view>
