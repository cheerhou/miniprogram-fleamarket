<!--category.wxml-->
<view class="page">

  <!-- 分类信息 -->
  <view class="category-info" wx:if="{{categoryName}}">
    <view class="category-header">
      <view class="category-icon">
        <t-icon name="home" size="24px" color="#757d89ff" />
      </view>
      <view class="category-details">
        <text class="category-name">{{categoryName}}</text>
        <text class="category-desc">发现更多好物</text>
      </view>
    </view>
    <view class="category-stats">
      <view class="stat-item">
        <text class="stat-number">{{items.length || 0}}</text>
        <text class="stat-label">件物品</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-number">0</text>
        <text class="stat-label">次浏览</text>
      </view>
    </view>
  </view>

  <!-- 主内容区 -->
  <scroll-view 
    class="main-content" 
    scroll-y 
    enhanced 
    show-scrollbar="{{false}}"
    bind:scrolltolower="onLoadMore"
  >
    <!-- 加载状态 -->
    <view class="loading-container" wx:if="{{loading && items.length === 0}}">
      <t-loading theme="circular" size="40rpx" text="加载中..." />
    </view>

    <!-- 空状态 -->
    <view class="empty-container" wx:if="{{!loading && items.length === 0}}">
      <t-icon name="info-circle" size="64rpx" color="#94a3b8" />
      <text class="empty-text">暂无相关物品</text>
      <text class="empty-desc">换个分类看看吧</text>
    </view>

    <!-- 物品列表 -->
    <view class="item-list" wx:if="{{items.length > 0}}">
      <view 
        class="item-card" 
        wx:for="{{items}}" 
        wx:key="id"
        bind:tap="onItemTap"
        data-id="{{item._id || item.id}}"
      >
        <view class="item-image {{item.status === 'sold' ? 'item-image-sold' : ''}}">
          <image 
            wx:if="{{item.images && item.images.length > 0}}"
            src="{{item.images[0]}}"
            mode="aspectFill"
            class="item-image-img"
            lazy-load
          />
          <text wx:else class="item-image-text">{{item.imageText || '暂无图片'}}</text>
        </view>
        <view class="item-info">
          <view class="item-header">
            <text class="item-title">{{item.title}}</text>
            <t-tag 
              theme="{{item.statusTheme}}" 
              variant="light" 
              size="small"
            >
              {{item.statusText}}
            </t-tag>
          </view>
          <text class="item-desc">{{item.description}}</text>
          
          <view class="item-price-row">
            <text class="item-price {{item.status === 'sold' ? 'item-price-sold' : ''}}">¥{{item.price}}</text>
            <view class="item-stats">
              <t-icon name="browse" size="14px" color="#94a3b8" />
              <text class="item-stats-text">{{item.views}} 人关注</text>
            </view>
          </view>

          <view class="item-footer">
            <view class="item-footer-left">
              <t-icon 
                name="{{item.footerIcon}}" 
                size="14px" 
                color="{{item.footerColor}}" 
              />
              <text class="item-footer-text" style="color: {{item.footerColor}}">
                {{item.footerText}}
              </text>
            </view>
            <t-button 
              wx:if="{{item.status === 'available'}}"
              theme="primary" 
              size="small"
              variant="outline"
              bind:tap="onLockItem"
              data-id="{{item.id}}"
            >
              去锁定
            </t-button>
            <t-button 
              wx:elif="{{item.status === 'locked'}}"
              theme="default" 
              size="small"
              bind:tap="onFollowItem"
              data-id="{{item.id}}"
            >
              关注
            </t-button>
            <text 
              wx:else
              class="item-link"
              catch:tap="onViewDetail"
              data-id="{{item.id}}"
            >
              查看详情
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{items.length > 0}}">
      <view wx:if="{{loadingMore}}">
        <t-loading theme="circular" size="32rpx" text="加载更多..." />
      </view>
      <text wx:elif="{{!hasMore}}" class="no-more">没有更多了</text>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-spacer"></view>
  </scroll-view>
</view>
