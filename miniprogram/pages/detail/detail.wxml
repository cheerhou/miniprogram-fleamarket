<!--detail.wxml-->
<view class="page">
  <view wx:if="{{loading}}" class="loading-container">
    <t-loading theme="circular" size="40rpx" text="加载中..." />
  </view>

  <view wx:else class="detail-container">
    <!-- 图片轮播 -->
    <view class="image-section">
      <swiper 
        class="image-swiper"
        indicator-dots="{{item.images.length > 1}}"
        autoplay="{{false}}"
        bind:change="onSwiperChange"
      >
        <swiper-item wx:for="{{item.images}}" wx:key="*this">
          <image 
            src="{{item}}" 
            mode="aspectFit"
            class="swiper-image"
            bind:tap="onPreviewImage"
          />
        </swiper-item>
      </swiper>
      
      <!-- 图片指示器 -->
      <view wx:if="{{item.images.length > 1}}" class="image-indicator">
        {{currentImageIndex + 1}} / {{item.images.length}}
      </view>
    </view>

    <!-- 物品信息 -->
    <view class="info-section">
      <view class="price-row">
        <text class="price">¥{{item.price}}</text>
        <view class="status-tag">
          <t-tag theme="success" variant="light" size="small">{{item.condition}}</t-tag>
        </view>
      </view>
      
      <view class="title-row">
        <text class="title">{{item.title}}</text>
      </view>
      
      <view class="meta-row">
        <view class="meta-item">
          <t-icon name="location" size="16px" color="#64748b" />
          <text class="meta-text">{{item.location}}</text>
        </view>
        <view class="meta-item">
          <t-icon name="browse" size="16px" color="#64748b" />
          <text class="meta-text">{{item.viewCount}} 人浏览</text>
        </view>
        <view class="meta-item">
          <t-icon name="time" size="16px" color="#64748b" />
          <text class="meta-text">{{item.publishTime}}</text>
        </view>
      </view>
    </view>

    <!-- 详细描述 -->
    <view class="section">
      <view class="section-title">物品描述</view>
      <view class="description">
        <text class="desc-text">{{item.description}}</text>
      </view>
    </view>

    <!-- 交易信息 -->
    <view class="section">
      <view class="section-title">交易信息</view>
      <view class="trade-info">
        <view class="trade-item">
          <text class="trade-label">分类</text>
          <text class="trade-value">{{item.category}}</text>
        </view>
        <view class="trade-item">
          <text class="trade-label">成色</text>
          <text class="trade-value">{{item.condition}}</text>
        </view>
        <view class="trade-item">
          <text class="trade-label">交易地点</text>
          <text class="trade-value">{{item.location}}</text>
        </view>
      </view>
    </view>

    <!-- 卖家信息 -->
    <view class="section">
      <view class="section-title">卖家信息</view>
      <view class="seller-info">
        <view class="seller-avatar">
          <image 
            wx:if="{{item.sellerAvatar}}"
            src="{{item.sellerAvatar}}"
            class="avatar-img"
          />
          <view wx:else class="avatar-placeholder">
            <t-icon name="user" size="24px" color="#94a3b8" />
          </view>
        </view>
        <view class="seller-details">
          <text class="seller-name">{{item.sellerName}}</text>
          <text class="seller-desc">信用良好</text>
        </view>
      </view>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-spacer"></view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-actions">
    <view class="action-left">
      <view wx:if="{{item.status === 'locked'}}" class="action-item" bind:tap="onFollowItem">
        <t-icon name="{{isFollowed ? 'heart-filled' : 'heart'}}" size="24px" color="{{isFollowed ? '#e34d59' : '#64748b'}}" />
        <text class="action-text" style="color: {{isFollowed ? '#e34d59' : '#64748b'}}">
          {{isFollowed ? '已订阅' : '订阅'}}
        </text>
      </view>
      <view class="action-item" bind:tap="onShare">
        <t-icon name="share" size="24px" color="#64748b" />
        <text class="action-text">分享</text>
      </view>
    </view>
    
    <view class="action-right">
      <t-button 
        wx:if="{{item.status === 'available' && !isLocked}}"
        theme="primary" 
        size="large"
        bind:tap="onLockItem"
      >
        立即锁定
      </t-button>
      <t-button 
        wx:elif="{{isLocked}}"
        theme="success" 
        size="large"
        disabled
      >
        已锁定
      </t-button>
      <t-button 
        wx:else
        theme="default" 
        size="large"
        bind:tap="onContactSeller"
      >
        联系卖家
      </t-button>
    </view>
  </view>
</view>
